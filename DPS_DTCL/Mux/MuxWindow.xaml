<Window x:Class="DTCL.MuxWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DTCL"
        mc:Ignorable="d"
        Title="DTCL Multiple Unit Performance Check"
        SizeToContent="WidthAndHeight"
        WindowStartupLocation="CenterScreen"
        Height="780"
        ResizeMode="CanMinimize" Closed="Window_Closed"
     >


    <!-- Resource Definitions (unchanged) -->
    <Window.Resources>
        <Style x:Key="BaseButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#27AE60"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Margin" Value="10"/>
            <Setter Property="Padding" Value="10,5"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="buttonBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="buttonBorder" Property="Background" Value="#2ECC71"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="SharedButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="FontSize" Value="22"/>
            <Setter Property="Height" Value="80"/>
            <Setter Property="Width" Value="180"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="PCSharedButtonStyle" TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
            <Setter Property="FontSize" Value="16"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="buttonBorder"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="buttonBorder" Property="Background" Value="#2ECC71"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter TargetName="buttonBorder" Property="Background" Value="#CCCCCC"/>
                                <Setter Property="Foreground" Value="#666666"/>
                                <Setter Property="Cursor" Value="Arrow"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style TargetType="Label">
            <Setter Property="FontSize" Value="24"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Foreground" Value="#2D3142"/>
            <Setter Property="Margin" Value="10"/>
        </Style>

        <Style x:Key="SelectPortCheckboxStyle" TargetType="CheckBox">
            <Setter Property="IsEnabled" Value="True"/>
            <Style.Triggers>
                <!-- When isDTCLConnected is false, disable it -->
                <DataTrigger Binding="{Binding isDTCLConnected}" Value="False">
                    <Setter Property="IsEnabled" Value="False"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

    </Window.Resources>

    <!-- Main Layout -->
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto" Margin="0,0,0,46" Width="930">
        <Grid x:Name="MULTI_DTCL" Margin="14,-5,10,13" Height="709" Width="890">
            <Grid.RowDefinitions>
                <RowDefinition Height="227*"/>
                <RowDefinition Height="603*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="95*"/>
                <ColumnDefinition Width="359*"/>
                <ColumnDefinition Width="347*"/>
            </Grid.ColumnDefinitions>

            <StackPanel x:Name="PerformanceCheckBlock"
                    Grid.ColumnSpan="3"
                    Background="#E0E0E0"
                    Margin="7,7,0,0"
                    Visibility="Visible" HorizontalAlignment="Left" Height="944" VerticalAlignment="Top" Width="889" Grid.RowSpan="2" KeyDown="PerformanceCheckBlock_KeyDown" Loaded="PerformanceCheckBlock_Loaded">

                <!-- Header -->
                <Label Content="DTCL MULTIPLE UNIT PERFORMANCE CHECK"
                   HorizontalAlignment="Center"/>



                <!-- Grid with DataGrid and buttons side-by-side -->
                <Grid Margin="10,5,10,5" Width="800">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="473"/>
                        <ColumnDefinition Width="92.5"/>
                        <ColumnDefinition Width="51.5"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <!-- DataGrid -->
                    <DataGrid x:Name="MuxChannelGrid"
              AutoGenerateColumns="false"
              CanUserAddRows="false"
              HeadersVisibility="Column"
              BeginningEdit="MuxChannelGrid_BeginningEdit"
              Margin="0,0,10,0"
              Grid.Column="0" Grid.ColumnSpan="3">
                        <DataGrid.CellStyle>
                            <Style TargetType="DataGridCell">
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="FontSize" Value="12"/>
                            </Style>
                        </DataGrid.CellStyle>
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="FontSize" Value="12"/>
                                <Setter Property="HorizontalContentAlignment" Value="Center"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Port No" Binding="{Binding Channel}" Width="55" IsReadOnly="True"/>
                            <DataGridCheckBoxColumn Header="DTCL Connection Status" Binding="{Binding isDTCLConnected}" Width="140" IsReadOnly="True" MinWidth="150"/>
                            <DataGridCheckBoxColumn
    Width="105"
    Binding="{Binding isUserSelected,
                      Mode=TwoWay,
                      UpdateSourceTrigger=PropertyChanged}" MinWidth="100" DisplayIndex="2">
                                <DataGridCheckBoxColumn.Header>
                                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                        <CheckBox x:Name="SelectAllCheckBox" 
                                                  Content="" 
                                                  HorizontalAlignment="Center"
                                                  VerticalAlignment="Center"
                                                  Checked="SelectAllCheckBox_Checked"
                                                  Unchecked="SelectAllCheckBox_Unchecked"
                                                  Margin="1,0"/>
                                        <TextBlock Text="Select Port" 
                                                   FontSize="12" 
                                                   FontWeight="Bold"
                                                   HorizontalAlignment="Center"
                                                   VerticalAlignment="Center"
                                                   Margin="2,0"/>
                                    </StackPanel>
                                </DataGridCheckBoxColumn.Header>
                                <!-- Display‐mode checkbox -->
                                <DataGridCheckBoxColumn.ElementStyle>
                                    <Style TargetType="CheckBox">
                                        <!-- default: disabled -->
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Style.Triggers>
                                            <!-- when DTCL is connected, enable -->
                                            <DataTrigger Binding="{Binding isDTCLConnected}" Value="True">
                                                <Setter Property="IsEnabled" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridCheckBoxColumn.ElementStyle>

                                <!-- Edit‐mode checkbox (when the cell is in edit) -->
                                <DataGridCheckBoxColumn.EditingElementStyle>
                                    <Style TargetType="CheckBox">
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding isDTCLConnected}" Value="True">
                                                <Setter Property="IsEnabled" Value="True"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridCheckBoxColumn.EditingElementStyle>
                            </DataGridCheckBoxColumn>

                            <DataGridTextColumn Header="Unit S.No"
                    Binding="{Binding UnitSno}"
                    Width="60" MinWidth="65">
                                <DataGridTextColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <!-- default: disabled -->
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="FontSize" Value="12"/>
                                        <Style.Triggers>
                                            <!-- Enable only if channel is selected AND withCart is checked -->
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding isUserSelected}" Value="True"/>
                                                    <Condition Binding="{Binding IsChecked, ElementName=withCart}" Value="True"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="IsEnabled" Value="True"/>
                                            </MultiDataTrigger>
                                            <!-- Enable only if channel is selected AND withOutCart is checked -->
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding isUserSelected}" Value="True"/>
                                                    <Condition Binding="{Binding IsChecked, ElementName=withOutCart}" Value="True"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="IsEnabled" Value="True"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.CellStyle>
                                <DataGridTextColumn.EditingElementStyle>
                                    <Style TargetType="TextBox">
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="FontSize" Value="12"/>
                                    </Style>
                                </DataGridTextColumn.EditingElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Cart Type" Binding="{Binding CartType}" Width="60" IsReadOnly="True" MinWidth="65"/>
                            <DataGridTextColumn Header="DTC S.No"
                    Binding="{Binding DtcSno}"
                    Width="60" MinWidth="65">
                                <DataGridTextColumn.CellStyle>
                                    <Style TargetType="DataGridCell">
                                        <!-- default: disabled -->
                                        <Setter Property="IsEnabled" Value="False"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="FontSize" Value="12"/>
                                        <Style.Triggers>
                                            <!-- Enable only if channel is selected AND withCart is checked -->
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding isUserSelected}" Value="True"/>
                                                    <Condition Binding="{Binding IsChecked, ElementName=withCart}" Value="True"/>
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="IsEnabled" Value="True"/>
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.CellStyle>
                                <DataGridTextColumn.EditingElementStyle>
                                    <Style TargetType="TextBox">
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="FontSize" Value="12"/>
                                    </Style>
                                </DataGridTextColumn.EditingElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Result" Binding="{Binding PCStatus}" Width="45" IsReadOnly="True"/>
                        </DataGrid.Columns>
                        <DataGrid.RowStyle>
                            <Style TargetType="DataGridRow">
                                <Style.Triggers>
                                    <!-- Currently executing channel - yellow -->
                                    <DataTrigger Binding="{Binding isInProgress}" Value="True">
                                        <Setter Property="Background" Value="Yellow"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGrid.RowStyle>
                    </DataGrid>

                    <!-- Buttons aligned vertically -->
                    <StackPanel Grid.Column="3" VerticalAlignment="Center" Height="196">
                        <Button x:Name="Scan" Content="Start" Style="{StaticResource PCSharedButtonStyle}" Width="168" Click="Scan_Click" Height="78"/>
                        <Button x:Name="Clear" Content="Clear" Style="{StaticResource PCSharedButtonStyle}" Width="166" Click="Clear_Click" Height="78"/>
                    </StackPanel>

                </Grid>

                <!-- Test Information (Compacted) -->
                <!-- Log Section -->

                <Grid Margin="10,10,10,5">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="69*" />
                        <ColumnDefinition Width="Auto" MinWidth="17" />
                        <ColumnDefinition Width="73*" />
                    </Grid.ColumnDefinitions>

                    <StackPanel Orientation="Vertical" Margin="10,10,81,5" Grid.ColumnSpan="3">

                        <Label Content="COMMANDS" x:Name="CommandsLabel" FontSize="18" FontWeight="Bold" HorizontalAlignment="left" Margin="150,0,0,10"/>
                        <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="0,0,0,10">
                            <Button x:Name="Erase" Content="Erase" Style="{StaticResource PCSharedButtonStyle}" Width="120" Margin="10,0"  Height="68"/>
                            <Button x:Name="Write" Content="Write" Style="{StaticResource PCSharedButtonStyle}" Width="120" Margin="10,0" />
                            <Button x:Name="Read" Content="Read" Style="{StaticResource PCSharedButtonStyle}" Width="120" Margin="10,0" />

                        </StackPanel>

                        <StackPanel Grid.Column="3" Orientation="Horizontal" Margin="0,0,0,10">

                            <Button x:Name="LoopBack" Grid.Row="1" Content="Loop Back" Style="{StaticResource PCSharedButtonStyle}" Width="120" Margin="150,0,0,0" Height="68" Click="LoopBack_Click"/>

                        </StackPanel>



                        <!-- Log Buttons -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="15,0,0,-0"/>


                        <Label HorizontalAlignment="Left" Content="Status/Cautions/Prompts" FontSize="16" FontWeight="Bold" Grid.Column="2" Margin="0,0,0,-1" Width="211"/>
                        <TextBox x:Name="StatusTextBlock" HorizontalAlignment="Left" Text="" FontSize="13.5" AcceptsReturn="True" TextWrapping="Wrap" FontWeight="Bold" Grid.Column="2" Margin="0,0,0,-10" Grid.RowSpan="2" Grid.ColumnSpan="2" Height="100" Width="410" IsReadOnly="True"/>

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" Margin="0,10,0,0">
                            <Image x:Name="Logo" Height="46" Width="58" Source="/swave_icon.png" MouseDown="Logo_MouseDown" Margin="0,0,0,0"/>
                            <TextBlock Text="S-WAVE SYSTEMS PVT LTD" Height="48" Width="160" Margin="-0,0,0,0"/>
                        </StackPanel>

                    </StackPanel>

                    <!-- Vertical Separator -->
                    <Border Grid.Column="1" Width="2" Background="ForestGreen" Margin="27,0,13,0" VerticalAlignment="Top" Height="280"/>




                    <!-- Commands Panel -->
                    <StackPanel Grid.Column="2" Orientation="Vertical" HorizontalAlignment="Center" Width="438">

                        <StackPanel Orientation="Horizontal" HorizontalAlignment="left" Margin="30,0,-150,0" Width="1004">
                            <RadioButton x:Name="withCart" Content="With Cartridge" GroupName="CartridgeOption" FontSize="14" FontWeight="Bold" Click="withCart_Click" Width="682" Height="21"/>
                            <RadioButton x:Name="withOutCart" Margin="-500,0,0,0" Content="Without Cartridge" GroupName="CartridgeOption" FontSize="14" FontWeight="Bold" IsChecked="True" Click="withOutCart_Click" Height="20" Width="624"/>
                        </StackPanel>

                        <!-- Test Number -->
                        <StackPanel Orientation="Horizontal" Margin="15,0,0,-18">
                            <Label Content="Test No:" FontSize="18" FontWeight="Bold" Width="165" VerticalAlignment="Center"/>
                            <TextBox x:Name="TestNumber" Text="999" FontSize="15" FontWeight="Bold" Width="200" Height="34"/>
                        </StackPanel>

                        <!-- Inspector Name -->
                        <StackPanel Orientation="Horizontal" Margin="15,0,0,-5">
                            <Label Content="Inspector Name:" FontSize="18" FontWeight="Bold" Width="165" VerticalAlignment="Center"/>
                            <TextBox x:Name="InspectorName" Text="999" FontSize="15" FontWeight="Bold" Width="200" Height="35"/>
                        </StackPanel>

                        <!-- Confirm Log Button -->
                        <Button x:Name="ConfirmLog" Margin="210,0,0,-10" Content="Confirm Log" Style="{StaticResource PCSharedButtonStyle}" Width="180" HorizontalAlignment="Left" Click="ConfirmLog_Click" Height="47"/>


                        <!-- Iteration / Duration Options -->
                        <StackPanel Orientation="Horizontal" Margin="0,20,0,0" HorizontalAlignment="Center" Width="421">

                            <Grid Margin="-6" Height="61">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <RadioButton x:Name="IterationSel" Content="No of Iterations" FontSize="14" FontWeight="Bold" Grid.Column="0" VerticalAlignment="Center" IsChecked="True" Margin="54,0,41,0" Click="IterationSel_Click_1"/>
                                <TextBox x:Name="IterationCount" Text="1" Grid.Row="0" FontWeight="Bold" FontSize="15" Grid.ColumnSpan="4" Margin="184,0,110,62" Grid.RowSpan="2" TextChanged="IterationCount_TextChanged"/>
                                <RadioButton x:Name="DurationSel" Content="Duration" FontSize="14" FontWeight="Bold" Grid.Row="1" Grid.Column="0" VerticalAlignment="Top" Margin="56,12,74,0" Click="DurationSel_Click_1"/>
                                <TextBox x:Name="DurationMin" Text="0" Grid.Row="1" FontWeight="Bold" FontSize="15" Margin="184,0,110,33" Grid.ColumnSpan="4" Height="25" VerticalAlignment="Bottom"/>
                                <Label Content="Min" VerticalAlignment="Top" HorizontalAlignment="Right" Width="45" Margin="0,6,69,0" FontSize="14" Grid.Column="2" RenderTransformOrigin="0.024,0.611" Grid.ColumnSpan="2" Grid.Row="1"/>
                                <TextBox x:Name="DurationSec" Text="10" Grid.Column="3" FontWeight="Bold" FontSize="15" Margin="65,9,30,35" Grid.Row="1"/>
                                <Label Content="Sec" Grid.Column="3" VerticalAlignment="Top" HorizontalAlignment="Left" Margin="111,8,0,0" FontSize="14" Width="35" RenderTransformOrigin="1.387,-0.482" Grid.Row="1"/>
                            </Grid>


                        </StackPanel>

                        <!-- Initiate / Stop Buttons -->
                        <StackPanel Orientation="Horizontal" Margin="-10,20,0,-20" HorizontalAlignment="Center">
                            <Button x:Name="InitiatePC" Content="Initiate PC" Width="120" Height="50" Style="{StaticResource PCSharedButtonStyle}" Click="InitiatePC_Click" Margin="00,0,10,10"/>
                            <Button x:Name="StopPc" Content="Stop" Width="120" Height="50" Style="{StaticResource PCSharedButtonStyle}" Click="StopPc_Click" Margin="00,0,10,10"/>
                            <Button x:Name="Exit" Content="Exit" Width="120" Height="50" Style="{StaticResource PCSharedButtonStyle}" Background="IndianRed" Margin="00,0,10,10" Click="Exit_Click"/>
                        </StackPanel>

                        <ProgressBar x:Name="PCProgressBar" Height="30" Minimum="0" Maximum="100" Value="0" Margin="20,25,10,10" Width="369"/>

                        <Grid Margin="-5">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="150"/>
                            </Grid.ColumnDefinitions>
                            <Label Content="Time Elapsed :" Grid.Column="0" FontWeight="Bold" VerticalAlignment="Top" FontSize="14" Margin="48,-1,5,0"/>
                            <TextBox x:Name="TimeElapsed" Width="100" Text="00000" FontSize="15" FontWeight="Bold" Grid.Row="0" Grid.Column="1" Margin="0,0,0,43"/>
                            <Label Content="Sec" Grid.Column="2" VerticalAlignment="Top" FontSize="14" FontWeight="Bold" Margin="5,-2,107,0"/>
                            <Label Content="Itr No" Grid.Column="0" VerticalAlignment="Top" FontSize="14" FontWeight="Bold" Margin="94,21,1,0"/>
                            <TextBox x:Name="CurrentIteration" Width="100" Text="00000" FontWeight="Bold" FontSize="15" Margin="0,24,0,18" Grid.Column="1"/>
                        </Grid>
                    </StackPanel>

                </Grid>




                <!-- Iteration/Duration Selection -->




                <!-- Progress Indicator -->

                <!-- Status Information -->
                <Grid Margin="10,5,10,5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="150"/>
                        <ColumnDefinition Width="100"/>
                        <ColumnDefinition Width="131*"/>
                        <ColumnDefinition Width="301*"/>
                    </Grid.ColumnDefinitions>


                </Grid>

            </StackPanel>
        </Grid>
    </ScrollViewer>


</Window>